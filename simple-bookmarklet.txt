ç®€å•æµ‹è¯•ä¹¦ç­¾è„šæœ¬ï¼ˆå¤åˆ¶æ•´è¡Œä½œä¸ºä¹¦ç­¾URLï¼‰ï¼š

javascript:(function(){alert('ğŸ” å¼€å§‹è°ƒè¯• Cursor ç¯å¢ƒ...');console.log('=== Claude Web è°ƒè¯•å¼€å§‹ ===');console.log('URL:', window.location.href);console.log('Protocol:', window.location.protocol);console.log('WebSocketæ”¯æŒ:', typeof WebSocket !== 'undefined');try{const ws=new WebSocket('ws://localhost:3000');ws.onopen=function(){console.log('âœ… WebSocketè¿æ¥æˆåŠŸ!');alert('âœ… WebSocketè¿æ¥æˆåŠŸï¼æœåŠ¡å™¨é€šä¿¡æ­£å¸¸');ws.send(JSON.stringify({type:'test',content:'æ¥è‡ªCursorçš„æµ‹è¯•æ¶ˆæ¯',timestamp:Date.now(),url:window.location.href}));setTimeout(()=>ws.close(),2000)};ws.onerror=function(error){console.log('âŒ WebSocketé”™è¯¯:',error);alert('âŒ WebSocketè¿æ¥å¤±è´¥: '+error)};ws.onclose=function(event){console.log('ğŸ”Œ WebSocketå…³é—­ (code:'+event.code+')')}}catch(error){console.log('ğŸ’¥ WebSocketå¼‚å¸¸:',error);alert('ğŸ’¥ WebSocketåˆ›å»ºå¤±è´¥: '+error.message)}console.log('é¡µé¢divæ•°é‡:',document.querySelectorAll('div').length);const chatKeywords=['chat','conversation','message','assistant','ai'];let foundElements=[];chatKeywords.forEach(keyword=>{document.querySelectorAll(`div[class*="${keyword}"]`).forEach((el,index)=>{if(index<3){foundElements.push(`${keyword}: ${el.className}`)}})});console.log('å¯èƒ½çš„èŠå¤©å…ƒç´ :',foundElements);alert('è°ƒè¯•ä¿¡æ¯å·²è¾“å‡ºåˆ°Consoleï¼Œè¯·æŸ¥çœ‹F12å¼€å‘è€…å·¥å…·');console.log('=== è°ƒè¯•ç»“æŸ ===')})();


å®Œæ•´åŠŸèƒ½ä¹¦ç­¾è„šæœ¬ï¼ˆå¤åˆ¶ä¸‹é¢æ•´è¡Œä½œä¸ºä¹¦ç­¾URLï¼‰ï¼š

javascript:(function(){console.log('ğŸš€ Claude Web å¢å¼ºç‰ˆå†…å®¹åŒæ­¥è„šæœ¬å·²åŠ è½½');class EnhancedCursorContentSync{constructor(){this.ws=null;this.lastContent='';this.chatContainer=null;this.syncInterval=null;this.retryCount=0;this.maxRetries=5;this.isDebugMode=true;this.init()}init(){this.log('ğŸ”§ åˆå§‹åŒ–åŒæ­¥ç³»ç»Ÿ...');this.showNotification('ğŸ” æ­£åœ¨æŸ¥æ‰¾èŠå¤©å†…å®¹...','#2196F3');setTimeout(()=>{this.findAndTestContainer();this.connectWebSocket()},2000)}log(message,...args){if(this.isDebugMode){console.log(`[Claude Web] ${message}`,...args)}}findAndTestContainer(){this.log('ğŸ” å¼€å§‹æŸ¥æ‰¾èŠå¤©å®¹å™¨...');const selectors=['[data-testid*="chat"]','[data-testid*="conversation"]','[data-testid*="messages"]','[data-testid*="assistant"]','.chat-container','.chat-panel','.conversation-container','.messages-container','.chat-content','.chat-view','.chat-messages','.conversation-messages','div[class*="chat"]','div[class*="conversation"]','div[class*="message"]','div[class*="dialog"]','div[class*="assistant"]','div[class*="ai"]','[role="main"]','[role="dialog"]','[role="log"]','main','section[class*="chat"]','.right-panel','.side-panel','.assistant-panel','.sidebar-right','.panel-right'];let foundContainer=null;let foundMethod='';for(const selector of selectors){try{const containers=document.querySelectorAll(selector);for(const container of containers){if(this.isValidChatContainer(container)){foundContainer=container;foundMethod=`ç²¾ç¡®åŒ¹é…: ${selector}`;break}}if(foundContainer)break}catch(error){this.log(`é€‰æ‹©å™¨é”™è¯¯ ${selector}:`,error.message)}}if(!foundContainer){this.log('ğŸ” å°è¯•é€šè¿‡æ¶ˆæ¯å…ƒç´ åå‘æŸ¥æ‰¾...');const messageSelectors=['div[class*="message"]','.message','[data-message]','[role="listitem"]','.chat-message','.user-message','.ai-message','.assistant-message','.bot-message','p[class*="message"]','span[class*="message"]'];for(const msgSelector of messageSelectors){try{const messages=document.querySelectorAll(msgSelector);if(messages.length>1){const parent=messages[0].closest('div[class*="chat"], div[class*="conversation"], div[class*="panel"], main, [role="main"], section');if(parent&&this.isValidChatContainer(parent)){foundContainer=parent;foundMethod=`æ¶ˆæ¯åå‘æŸ¥æ‰¾: ${msgSelector} -> ${parent.tagName}.${parent.className}`;break}}}catch(error){this.log(`æ¶ˆæ¯é€‰æ‹©å™¨é”™è¯¯ ${msgSelector}:`,error.message)}}}if(!foundContainer){this.log('ğŸ” å°è¯•å¯å‘å¼æŸ¥æ‰¾...');const allDivs=document.querySelectorAll('div');let bestCandidate=null;let bestScore=0;for(const div of allDivs){const score=this.calculateContainerScore(div);if(score>bestScore&&score>50){bestScore=score;bestCandidate=div}}if(bestCandidate){foundContainer=bestCandidate;foundMethod=`å¯å‘å¼æŸ¥æ‰¾: å¾—åˆ†${bestScore}`}}if(foundContainer){this.chatContainer=foundContainer;this.log('âœ… æ‰¾åˆ°èŠå¤©å®¹å™¨:',foundMethod);this.showNotification(`âœ… æ‰¾åˆ°èŠå¤©åŒºåŸŸ\n${foundMethod}`,'#4CAF50');const testContent=this.getChatContent();if(testContent&&testContent.html.length>100){this.log('âœ… å†…å®¹æå–æµ‹è¯•æˆåŠŸï¼Œé•¿åº¦:',testContent.html.length)}else{this.log('âš ï¸ å†…å®¹æå–æµ‹è¯•å¤±è´¥æˆ–å†…å®¹å¤ªå°‘');this.showNotification('âš ï¸ æ‰¾åˆ°å®¹å™¨ä½†å†…å®¹è¾ƒå°‘','#FF9800')}}else{this.log('âŒ æœªæ‰¾åˆ°åˆé€‚çš„èŠå¤©å®¹å™¨ï¼Œä½¿ç”¨body');this.chatContainer=document.body;this.showNotification('âŒ æœªæ‰¾åˆ°èŠå¤©åŒºåŸŸï¼Œä½¿ç”¨æ•´ä¸ªé¡µé¢','#FF5722')}this.outputDebugInfo()}isValidChatContainer(element){if(!element||!element.children)return false;const childCount=element.children.length;const textLength=element.textContent.length;const rect=element.getBoundingClientRect();return childCount>=2&&textLength>=50&&rect.width>200&&rect.height>100}calculateContainerScore(element){let score=0;try{const rect=element.getBoundingClientRect();const childCount=element.children.length;const textLength=element.textContent.length;const className=element.className.toLowerCase();if(childCount>=5)score+=20;if(textLength>=200)score+=20;if(rect.width>300)score+=10;if(rect.height>300)score+=10;if(rect.right>window.innerWidth*0.6)score+=15;if(rect.width>window.innerWidth*0.3)score+=10;const keywords=['chat','conversation','message','assistant','ai','dialog'];keywords.forEach(keyword=>{if(className.includes(keyword))score+=15});if(className.includes('sidebar')&&rect.width<300)score-=20;if(className.includes('menu'))score-=20;if(element.tagName==='SCRIPT'||element.tagName==='STYLE')score-=100}catch(error){return 0}return score}outputDebugInfo(){this.log('ğŸ“Š é¡µé¢è°ƒè¯•ä¿¡æ¯:');this.log('  - URL:',window.location.href);this.log('  - Title:',document.title);this.log('  - æ€»divæ•°é‡:',document.querySelectorAll('div').length);const classNames=new Set();document.querySelectorAll('div[class]').forEach(div=>{if(div.className&&div.className.length<100){div.className.split(' ').forEach(cls=>{if(cls.length>3)classNames.add(cls)})}});this.log('  - ä¸»è¦classåç§°:',Array.from(classNames).slice(0,20))}connectWebSocket(){this.log('ğŸ”Œ å°è¯•è¿æ¥ WebSocket...');const protocol=window.location.protocol==='https:'?'wss:':'ws:';const wsUrl=`${protocol}//localhost:3000`;try{this.ws=new WebSocket(wsUrl);this.ws.onopen=()=>{this.log('âœ… WebSocketè¿æ¥æˆåŠŸ');this.showNotification('âœ… è¿æ¥æœåŠ¡å™¨æˆåŠŸ!','#4CAF50');this.retryCount=0;this.sendInitialContent();this.startContentSync()};this.ws.onclose=(event)=>{this.log(`âŒ WebSocketè¿æ¥æ–­å¼€ (code: ${event.code})`);if(this.retryCount<this.maxRetries){this.retryCount++;this.showNotification(`ğŸ”„ è¿æ¥æ–­å¼€ï¼Œ5ç§’åé‡è¯• (${this.retryCount}/${this.maxRetries})`,'#FF9800');setTimeout(()=>this.connectWebSocket(),5000)}else{this.showNotification('âŒ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æœåŠ¡å™¨','#FF5722')}};this.ws.onerror=(error)=>{this.log('ğŸ”¥ WebSocketé”™è¯¯:',error);this.showNotification('ğŸ”¥ è¿æ¥é”™è¯¯ï¼Œæ£€æŸ¥é˜²ç«å¢™è®¾ç½®','#FF5722')}}catch(error){this.log('ğŸ’¥ WebSocketåˆ›å»ºå¤±è´¥:',error);this.showNotification('ğŸ’¥ WebSocketä¸å¯ç”¨','#FF5722')}}getChatContent(){if(!this.chatContainer)return null;try{const clone=this.chatContainer.cloneNode(true);const removeSelectors=['script','style','link[rel="stylesheet"]','.tooltip','.popup','.dropdown','.overlay','.menu','[data-testid*="toolbar"]','[class*="toolbar"]','[class*="sidebar"]','button[class*="close"]','button[class*="minimize"]','input','textarea','.notification','.toast','.alert'];removeSelectors.forEach(selector=>{try{clone.querySelectorAll(selector).forEach(el=>el.remove())}catch(e){}});clone.querySelectorAll('*').forEach(el=>{try{[...el.attributes].forEach(attr=>{if(attr.name.startsWith('on')||attr.name.startsWith('data-')||attr.name==='style'||attr.name==='contenteditable'){el.removeAttribute(attr.name)}})}catch(e){}});return{html:clone.innerHTML,timestamp:Date.now(),url:window.location.href,title:document.title,containerInfo:{tagName:this.chatContainer.tagName,className:this.chatContainer.className,childrenCount:this.chatContainer.children.length}}}catch(error){this.log('âŒ è·å–å†…å®¹å¤±è´¥:',error);return null}}sendContent(content){if(this.ws&&this.ws.readyState===WebSocket.OPEN){try{this.ws.send(JSON.stringify({type:'html_content',data:content}));this.log(`ğŸ“¤ å†…å®¹å·²å‘é€ï¼Œå¤§å°: ${content.html.length} å­—ç¬¦`)}catch(error){this.log('ğŸ“¤ å‘é€å¤±è´¥:',error)}}}sendInitialContent(){const content=this.getChatContent();if(content){this.sendContent(content);this.lastContent=content.html;this.log('ğŸ“‹ åˆå§‹å†…å®¹å·²å‘é€')}}startContentSync(){this.syncInterval=setInterval(()=>{const content=this.getChatContent();if(content&&content.html!==this.lastContent){this.log('ğŸ”„ å†…å®¹å˜åŒ–ï¼ŒåŒæ­¥ä¸­...');this.sendContent(content);this.lastContent=content.html}},3000);if(this.chatContainer){const observer=new MutationObserver((mutations)=>{let hasSignificantChange=false;mutations.forEach(mutation=>{if(mutation.type==='childList'&&mutation.addedNodes.length>0){for(const node of mutation.addedNodes){if(node.nodeType===Node.ELEMENT_NODE&&node.textContent&&node.textContent.trim().length>10){hasSignificantChange=true;break}}}});if(hasSignificantChange){setTimeout(()=>{const content=this.getChatContent();if(content&&content.html!==this.lastContent){this.sendContent(content);this.lastContent=content.html}},1000)}});observer.observe(this.chatContainer,{childList:true,subtree:true,characterData:true});this.log('ğŸ‘€ DOMç›‘å¬å™¨å·²å¯åŠ¨')}}showNotification(message,color='#2196F3'){const oldNotification=document.getElementById('claude-web-notification');if(oldNotification){oldNotification.remove()}const notification=document.createElement('div');notification.id='claude-web-notification';notification.style.cssText=`position:fixed;top:20px;right:20px;z-index:99999;background:${color};color:white;padding:12px 16px;border-radius:6px;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.3);max-width:320px;white-space:pre-line;word-wrap:break-word`;notification.textContent=message;try{document.body.appendChild(notification);setTimeout(()=>{if(notification.parentNode){notification.remove()}},5000)}catch(error){this.log('é€šçŸ¥æ˜¾ç¤ºå¤±è´¥:',error)}}}function initCursorSync(){if(window.CursorContentSync){console.log('Claude Web åŒæ­¥è„šæœ¬å·²å­˜åœ¨');return}console.log('ğŸš€ å¯åŠ¨ Claude Web åŒæ­¥è„šæœ¬...');window.CursorContentSync=new EnhancedCursorContentSync()}if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',initCursorSync)}else{setTimeout(initCursorSync,1000)}})();
